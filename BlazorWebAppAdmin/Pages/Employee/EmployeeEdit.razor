@page "/employees/edit/{Id:int}"
@using BlazorWebAppAdmin.Services
@using helperMovies.Constants
@inject IEmployeeService EmployeeService
@inject IRoleService RoleService
@inject NavigationManager NavigationManager

<DashboardHeader Title="Dashboard"
                 BreadcrumbMain="Employee"
                 BreadcrumbCurrent="Edit" />

@if (isLoading)
{
    <div class="text-center mt-4">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2 text-muted">Loading employee data...</p>
    </div>
}
else
{
    <div class="card shadow-sm p-4">
        <h4 class="text-primary mb-3">
            <i class="bi bi-pencil-square me-2"></i>Edit Employee Information
        </h4>
        <hr />

        <EditForm Model="@employee" OnValidSubmit="HandleValidSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Full Name</label>
                    <InputText class="form-control" @bind-Value="employee.FullName" />
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Gender</label><br />
                    <InputRadioGroup @bind-Value="employee.Gender">
                        <InputRadio class="form-check-input me-1" Value="true" /> Male
                        <InputRadio class="form-check-input ms-3 me-1" Value="false" /> Female
                    </InputRadioGroup>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Email</label>
                    <InputText class="form-control" @bind-Value="employee.Email" />
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Phone</label>
                    <InputText class="form-control" @bind-Value="employee.PhoneNumber" />
                </div>

                <div class="col-md-12 mb-3">
                    <label class="form-label fw-bold">Address</label>
                    <InputText class="form-control" @bind-Value="employee.Address" />
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Job Status</label>
                    <InputSelect class="form-control" @bind-Value="employee.JobStatus">
                        <option value="@JobStatusValue.WORKING">Working</option>
                        <option value="@JobStatusValue.RETIRED">Retired</option>
                    </InputSelect>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Date of Birth</label>
                    <InputDate class="form-control" @bind-Value="employee.DateOfBirth" />
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label fw-bold">Salary</label>
                    <InputNumber class="form-control" @bind-Value="employee.Salary" />
                </div>
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-success me-2">
                    <i class="bi bi-check-circle"></i> Save Changes
                </button>
                <button type="button" class="btn btn-secondary" @onclick="BackToList">
                    <i class="bi bi-arrow-left"></i> Back to List
                </button>
            </div>
        </EditForm>

        @if (!string.IsNullOrEmpty(message))
        {
            <div class="alert alert-info mt-3">
                <i class="bi bi-info-circle me-1"></i> @message
            </div>
        }
    </div>
}

@code {
    [Parameter] public int Id { get; set; }

    private EmployeeViewModel employee = new();
    private string message = string.Empty;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            employee = await EmployeeService.GetByIdAsync(Id);
        }
        catch (Exception ex)
        {
            message = $"Error loading employee data: {ex.Message}";
        }
        finally
        {
            isLoading = false;
        }
    }

    private async Task HandleValidSubmit()
    {
        try
        {
            await EmployeeService.UpdateEmployeeAsync(Id, employee);
            message = "Employee information updated successfully!";
            await Task.Delay(1000);
            NavigationManager.NavigateTo("/employees");
        }
        catch (Exception ex)
        {
            message = $"Failed to update employee: {ex.Message}";
        }
    }

    private void BackToList()
    {
        NavigationManager.NavigateTo("/employees");
    }
}
