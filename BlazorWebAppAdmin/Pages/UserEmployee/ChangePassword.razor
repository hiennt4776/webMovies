@page "/useremployees/changepassword"
@using BlazorWebAppAdmin.Services
@using Blazored.LocalStorage
@using helperMovies.Constants
@inject IUserEmployeeService UserEmployeeService
@inject ILocalStorageService LocalStorage
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime


<DashboardHeader Title="Dashboard"
                 BreadcrumbMain="User Employee"
                 BreadcrumbCurrent="Change Password" />


<EditForm Model="@model" OnValidSubmit="OnChangePasswordAsync">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label class="form-label">Mật khẩu cũ</label>
        <InputText type="password" class="form-control" @bind-Value="model.OldPassword" />
    </div>

    <div class="mb-3">
        <label class="form-label">Mật khẩu mới</label>
        <InputText type="password" class="form-control" @bind-Value="model.NewPassword" />
    </div>

    <div class="mb-3">
        <label class="form-label">Xác nhận mật khẩu mới</label>
        <InputText type="password" class="form-control" @bind-Value="model.ConfirmPassword" />
    </div>

    <button type="submit" class="btn btn-primary">Đổi mật khẩu</button>
</EditForm>

@if (!string.IsNullOrEmpty(message))
{
    <div class="alert mt-3 @(isSuccess ? "alert-success" : "alert-danger")">
        @message
    </div>
}

@code {
    private ChangePasswordViewModel model = new();
    private string message = string.Empty;
    private bool isSuccess = false;

    protected override async Task OnInitializedAsync()
    {
        // Lấy userId từ LocalStorage (đã lưu khi đăng nhập)
        var userId = await LocalStorage.GetItemAsync<int>("userId");
        model.UserId = userId;
    }

    private async Task OnChangePasswordAsync()
    {

        var success = await UserEmployeeService.ChangePasswordAsync(model);
        NavigationManager.NavigateTo("/userEmployees");


    }
}
